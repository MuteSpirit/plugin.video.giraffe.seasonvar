import os.path
import pytest
from seasonvar.cache import Cache


def cache_dir():
    return os.path.join(os.path.dirname(__file__), 'assets', 'cache')


def cache_path(path):
    return os.path.join(cache_dir(), path)


@pytest.mark.parametrize('asset, expected_dates', [
    ('single', ['03.04.2017']),
    ('multiple', ['03.04.2017', '02.04.2017'])
])
def test_cache_dayblocks(asset, expected_dates):
    cache = Cache(cache_path(asset))
    dates = [d for d, items in cache._main_page_dayblocks()]
    assert dates == expected_dates

@pytest.mark.parametrize('asset, expected_items', [
    ('single', [
        {
            'changes': '(6 сезон) 11 серия (Amedia)',
            'name': 'Родина',
            'url': '/serial-14903-Rodina-00006-sezon.html'
        },
        {
            'changes': '10 серия (Котова)',
            'name': 'До самой смерти',
            'url': '/serial-14996-Do_samoj_smerti.html'
        },
        {
            'changes': '(3 сезон) 10 серия (Amedia)',
            'name': 'Игроки / Футболисты',
            'url': '/serial-15971-Igroki--03-sezon.html'
        }]),
])
def test_cache_dayblock_items(asset, expected_items):
    cache = Cache(cache_path(asset))
    dayblocks = [items for date, items in cache._main_page_dayblocks()]
    assert dayblocks[0] == expected_items
